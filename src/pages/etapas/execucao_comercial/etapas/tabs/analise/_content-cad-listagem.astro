<style>
    [data-table="cloneJquery"] tr:first-child [data-tb-btn="del"]{ display: none;}
</style>

<div class="table-responsive">
    <table class="table table-bordered table-hover table-fixed" data-table="cloneJquery" id="tableCloneAnalise">
        <thead>
            <tr>
                <th style="width: 150px;" rowspan="2">Data da Pesquisa</th>
                <th style="width: 150px;" rowspan="2">Marca do Concorrente</th>
                <th style="width: 150px;" rowspan="2">Endereço</th>
                <th style="width: 150px;" rowspan="2">Telefone</th>
                <th style="width: 150px;" rowspan="2">Distância da Unidade</th>
                <th style="width: 150px;" rowspan="2">Observação</th>
                <th style="width: 150px;" rowspan="2">Modalidade</th>
                <th style="width: 150px;" rowspan="2">promoção Vigente</th>

                <th style="width: 600px;" colspan="4">Matrícula</th>
                <th style="width: 600px;" colspan="4">Mensalidade</th>
                <th style="width: 600px;" colspan="4">Material (VLR Mensal)</th>
                <th style="width: 600px;" colspan="4">Atendimento</th>
                <th style="width: 600px;" colspan="4">Estrutura</th>

                <th style="width: 70px;" rowspan="2">Ações</th>
            </tr>

            <tr>
                <th>Kids</th>
                <th>Teens</th>
                <th>Adults</th>
                <th>Others</th>

                <th>Kids</th>
                <th>Teens</th>
                <th>Adults</th>
                <th>Others</th>

                <th>Kids</th>
                <th>Teens</th>
                <th>Adults</th>
                <th>Others</th>

                <th>Kids</th>
                <th>Teens</th>
                <th>Adults</th>
                <th>Others</th>

                <th>Kids</th>
                <th>Teens</th>
                <th>Adults</th>
                <th>Others</th>
            </tr>
        </thead>

        <tbody>
            <tr>
                <td>
                    <input type="date" id="data_pesquisa_0" name="data_pesquisa_0" class="form-control">
                </td>
                <td>
                    <input type="text" id="marca_concorrente_0" name="marca_concorrente_0" class="form-control">
                </td>
                <td>
                    <input type="text" id="endereco_0" name="endereco_0" class="form-control">
                </td>
                <td>
                    <input type="text" id="telefone_0" name="telefone_0" class="form-control text-center jQueryMask-sp_celphones" placeholder="(00) 0000-0000">
                </td>
                <td>
                    <input type="text" id="distancia_0" name="distancia_0" class="form-control">
                </td>
                <td>
                    <input type="text" id="observacao_0" name="observacao_0" class="form-control">
                </td>
                <td>
                    <input type="text" id="modalidade_0" name="modalidade_0" class="form-control">
                </td>
                <td>
                    <input type="text" id="promocao_vigente_0" name="promocao_vigente_0" class="form-control">
                </td>


                <td>
                    <input type="text" id="matricula_kids_0" name="matricula_kids_0" class="form-control text-center jQueryMask-money">
                </td>
                <td>
                    <input type="text" id="matricula_teens_0" name="matricula_teens_0" class="form-control text-center jQueryMask-money">
                </td>
                <td>
                    <input type="text" id="matricula_adults_0" name="matricula_adults_0" class="form-control text-center jQueryMask-money">
                </td>
                <td>
                    <input type="text" id="matricula_others_0" name="matricula_others_0" class="form-control text-center jQueryMask-money">
                </td>


                <td>
                    <input type="text" id="mensalidade_kids_0" name="mensalidade_kids_0" class="form-control text-center jQueryMask-money">
                </td>
                <td>
                    <input type="text" id="mensalidade_teens_0" name="mensalidade_teens_0" class="form-control text-center jQueryMask-money">
                </td>
                <td>
                    <input type="text" id="mensalidade_adults_0" name="mensalidade_adults_0" class="form-control text-center jQueryMask-money">
                </td>
                <td>
                    <input type="text" id="mensalidade_others_0" name="mensalidade_others_0" class="form-control text-center jQueryMask-money">
                </td>


                <td>
                    <input type="text" id="material_kids_0" name="material_kids_0" class="form-control text-center jQueryMask-money">
                </td>
                <td>
                    <input type="text" id="material_teens_0" name="material_teens_0" class="form-control text-center jQueryMask-money">
                </td>
                <td>
                    <input type="text" id="material_adults_0" name="material_adults_0" class="form-control text-center jQueryMask-money">
                </td>
                <td>
                    <input type="text" id="material_others_0" name="material_others_0" class="form-control text-center jQueryMask-money">
                </td>


                <td>
                    <input type="text" id="atendimento_kids_0" name="atendimento_kids_0" class="form-control text-center">
                </td>
                <td>
                    <input type="text" id="atendimento_teens_0" name="atendimento_teens_0" class="form-control text-center">
                </td>
                <td>
                    <input type="text" id="atendimento_adults_0" name="atendimento_adults_0" class="form-control text-center">
                </td>
                <td>
                    <input type="text" id="atendimento_others_0" name="atendimento_others_0" class="form-control text-center">
                </td>


                <td>
                    <input type="text" id="estrutura_kids_0" name="estrutura_kids_0" class="form-control text-center">
                </td>
                <td>
                    <input type="text" id="estrutura_teens_0" name="estrutura_teens_0" class="form-control text-center">
                </td>
                <td>
                    <input type="text" id="estrutura_adults_0" name="estrutura_adults_0" class="form-control text-center">
                </td>
                <td>
                    <input type="text" id="estrutura_others_0" name="estrutura_others_0" class="form-control text-center">
                </td>

                <!-- botões del -->

                <td>
                    <div class="d-flex justify-content-center">
                        <div class="d-flex align-items-center justify-content-between gap-2" style="width: 40px">
                            <button type="button" data-tb-btn="del" class="btn border-0 p-0 fs-5" data-bs-toggle="tooltip" data-bs-title="Del">
                                <i class="bi bi-trash text-danger pe-none"></i>
                            </button>

                            <button type="button" data-tb-btn="add" class="btn border-0 p-0 fs-5" data-bs-toggle="tooltip" data-bs-title="Add">
                                <i class="bi bi-plus-circle text-success pe-none"></i>
                            </button>
                        </div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<script is:inline src="/assets/vendor/jquery.mask.min.js"></script>

<script is:inline>
    const tableBody = $('#tableCloneAnalise tbody')
    let rowIndex = 1

    // Adicionar uma nova linha
    function addRow() {
        const firstRow = tableBody.find('tr:first')
        const newRow = firstRow.clone()

        newRow.find('input').each(function() {
            const field = $(this);
            const name = field.attr("name")
            const id = field.attr("id")

            if (name) {
                const newName = name.replace(/_\d+$/, `_${rowIndex}`)
                field.attr("name", newName)
            }
            if (id) {
                const newId = id.replace(/_\d+$/, `_${rowIndex}`)
                field.attr("id", newId)
            }
        })

        tableBody.append(newRow)
        rowIndex++
    }

    // Adicionar linha ao pressionar a tecla de seta para baixo
    $(document).keydown(function(e) {
        if (e.key === 'ArrowDown') {
            addRow()
            tableBody.find('tr:last input:first').focus()
        }
    })

    // Adicionar evento aos botões "Adicionar" e "Deletar"
    tableBody.on('click', '[data-tb-btn]', function(e) {
        if ($(this).data('tb-btn') === 'add') {
            addRow();
            //reativa plugins
            $('[data-bs-toggle="tooltip"]').tooltip()
        }
        else if ($(this).data('tb-btn') === 'del') {
            const row = $(this).closest('tr');
            //destroy plugins
            row.find('[data-bs-toggle="tooltip"]').tooltip('dispose');
            row.remove();
        }
    })
</script>
